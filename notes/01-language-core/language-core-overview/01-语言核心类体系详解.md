# Java语言核心类体系详解

## 一、语言核心类体系架构

### 1.1 核心类层次结构

```
Object（所有类的基类）
├── Class（类对象）
├── String（字符串）
├── StringBuffer（可变字符串缓冲区）
├── StringBuilder（可变字符串构建器）
├── 包装类（Wrapper Classes）
│   ├── Integer
│   ├── Long
│   ├── Double
│   ├── Float
│   ├── Short
│   ├── Byte
│   ├── Character
│   └── Boolean
├── Math（数学工具类）
├── System（系统工具类）
└── Thread（线程类）
```

### 1.2 核心类概述

| 类名 | 作用 | 特点 |
|------|------|------|
| Object | 所有类的基类 | 提供基本方法 |
| Class | 类的运行时表示 | 反射机制核心 |
| String | 不可变字符串 | 线程安全、常量池 |
| StringBuffer | 可变字符串缓冲区 | 线程安全 |
| StringBuilder | 可变字符串构建器 | 非线程安全、高性能 |
| 包装类 | 基本类型的对象表示 | 自动装箱/拆箱 |
| Math | 数学工具类 | 静态方法 |
| System | 系统工具类 | 访问系统资源 |
| Thread | 线程类 | 多编程 |

## 二、Object类详解

### 2.1 Object类概述

**Object特点**：
- 所有类的基类
- 提供基本方法
- 支持线程同步（wait/notify）
- 支持对象克隆
- 支持垃圾回收

### 2.2 核心方法

#### 2.2.1 getClass() - 获取运行时类

```java
public final native Class<?> getClass();
```

**特点**：
- native方法
- final方法，不能重写
- 返回对象的运行时Class对象

**使用示例**：

```java
Object obj = "Hello";
Class<?> clazz = obj.getClass();
System.out.println(clazz.getName());  // java.lang.String
```

#### 2.2.2 hashCode() - 获取哈希码

```java
public native int hashCode();
```

**特点**：
- native方法
- 默认实现：将对象内部地址转换为整数
- 应该与equals()方法保持一致性

**hashCode()契约**：
1. 同一对象多次调用hashCode()，应该返回相同的整数
2. 如果两个对象equals()返回true，它们的hashCode()应该相同
3. 如果两个对象equals()返回false，它们的hashCode()可以不同（但最好不同）

**重写示例**：

```java
public class Person {
    private String name;
    private int age;
    
    @Override
    public int hashCode() {
        return Objects.hash(name, age);
    }
}
```

#### 2.2.3 equals(Object obj) - 判断相等

```java
public boolean equals(Object obj) {
    return (this == obj);
}
```

**默认实现**：比较对象引用（==）

**equals()契约**：
1. 自反性：x.equals(x)应该返回true
2. 对称性：x.equals(y)应该与y.equals(x)相同
3. 传递性：如果x.equals(y)和y.equals(z)都返回true，那么x.equals(z)应该返回true
4. 一致性：多次调用equals()应该返回相同的结果
5. 非空性：x.equals(null)应该返回false

**重写示例**：

```java
public class Person {
    private String name;
    private int age;
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null || getClass() != obj.getClass()) {
            return false;
        }
        Person person = (Person) obj;
        return age == person.age && Objects.equals(name, person.name);
    }
}
```

#### 2.2.4 clone() - 克隆对象

```java
protected native Object clone() throws CloneNotSupportedException;
```

**特点**：
- protected方法
- native方法
- 默认实现：浅拷贝
- 需要实现Cloneable接口

**使用示例**：

```java
public class Person implements Cloneable {
    private String name;
    private int age;
    
    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}

// 使用
Person p1 = new Person();
Person p2 = (Person) p1.clone();
```

#### 2.2.5 toString() - 转换为字符串

```java
public String toString() {
    return getClass().getName() + "@" + Integer.toHexString(hashCode());
}
```

**默认实现**：返回类名@哈希码

**重写示例**：

```java
public class Person {
    private String name;
    private int age;
    
    @Override
    public String toString() {
        return "Person{name='" + name + "', age=" + age + "}";
    }
}
```

#### 2.2.6 notify() - 唤醒单个等待线程

```java
public final native void notify();
```

**特点**：
- final方法，不能重写
- native方法
- 唤醒在此对象监视器上等待的单个线程

#### 2.2.7 notifyAll() - 唤醒所有等待线程

```java
public final native void notifyAll();
```

**特点**：
- final方法，不能重写
- native方法
- 唤醒在此对象监视器上等待的所有线程

#### 2.2.8 wait(long timeout) - 等待指定时间

```java
public final native void wait(long timeout) throws InterruptedException;
```

**特点**：
- final方法，不能重写
- native方法
- 释放对象锁，等待其他线程调用notify()或notifyAll()
- 超时后自动唤醒

#### 2.2.9 wait() - 无限等待

```java
public final void wait() throws InterruptedException {
    wait(0);
}
```

#### 2.2.10 wait(long timeout, int nanos) - 等待指定时间（纳秒精度）

```java
public final void wait(long timeout, int nanos) throws InterruptedException {
    if (timeout < 0) {
        throw new IllegalArgumentException("timeout value is negative");
    }
    if (nanos < 0 || nanos > 999999) {
        throw new IllegalArgumentException(
            "nanosecond timeout value out of range");
    }
    if (nanos >= 500000 || (nanos != 0 && timeout == 0)) {
        timeout++;
    }
    wait(timeout);
}
```

#### 2.2.11 finalize() - 垃圾回收前调用

```java
protected void finalize() throws Throwable { }
```

**特点**：
- protected方法
- 垃圾回收器在回收对象前调用
- 已废弃，不建议使用

**替代方案**：使用Cleaner或PhantomReference

### 2.3 使用示例

#### 2.3.1 重写equals()和hashCode()

```java
public class Person {
    private String name;
    private int age;
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null || getClass() != obj.getClass()) {
            return false;
        }
        Person person = (Person) obj;
        return age == person.age && Objects.equals(name, person.name);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(name, age);
    }
}
```

#### 2.3.2 重写toString()

```java
public class Person {
    private String name;
    private int age;
    
    @Override
    public String toString() {
        return "Person{name='" + name + "', age=" + age + "}";
    }
}
```

#### 2.3.3 实现Cloneable接口

```java
public class Person implements Cloneable {
    private String name;
    private int age;
    
    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

#### 2.3.4 使用wait/notify

```java
public class ProducerConsumer {
    private final Object lock = new Object();
    private int count = 0;
    
    public void produce() throws InterruptedException {
        synchronized (lock) {
            while (count >= 10) {
                lock.wait();
            }
            count++;
            System.out.println("Produced: " + count);
            lock.notifyAll();
        }
    }
    
    public void consume() throws InterruptedException {
        synchronized (lock) {
            while (count <= 0) {
                lock.wait();
            }
            count--;
            System.out.println("Consumed: " + count);
            lock.notifyAll();
        }
    }
}
```

## 三、Class类详解

### 3.1 Class类概述

**Class特点**：
- 表示类和接口的运行时对象
- 反射机制的核心
- 枚举是一种类，注解是一种接口
- 数组也由Class对象表示

### 3.2 核心方法

#### 3.2.1 getName() - 获取类名

```java
public String getName() {
    String name = this.name;
    if (name == null) {
        this.name = name = getName0();
    }
    return name;
}

private native String getName0();
```

**特点**：
- 返回类的全限定名
- 数组类返回"[L" + 元素类型名 + ";"

**使用示例**：

```java
Class<?> clazz = String.class;
System.out.println(clazz.getName());  // java.lang.String

Class<?> arrayClazz = String[].class;
System.out.println(arrayClazz.getName());  // [Ljava.lang.String;
```

#### 3.2.2 getSimpleName() - 获取简单类名

```java
public String getSimpleName() {
    if (isArray()) {
        return getComponentType().getSimpleName() + "[]";
    }
    String simpleName = this.simpleName;
    if (simpleName == null) {
        Class<?> enclosingClass = getEnclosingClass();
        if (enclosingClass == null) {
            simpleName = getName0();
        } else {
            simpleName = getName0().substring(enclosingClass.getName().length());
        }
        this.simpleName = simpleName;
    }
    return simpleName;
}
```

**使用示例**：

```java
Class<?> clazz = String.class;
System.out.println(clazz.getSimpleName());  // String
```

#### 3.2.3 getPackage() - 获取包

```java
public Package getPackage() {
    return Package.getPackage(this.packageName);
}
```

**使用示例**：

```java
Class<?> clazz = String.class;
Package pkg = clazz.getPackage();
System.out.println(pkg.getName());  // java.lang
```

#### 3.2.4 getSuperclass() - 获取父类

```java
public native Class<? super T> getSuperclass();
```

**特点**：
- 返回父类的Class对象
- 如果是Object类或接口，返回null

**使用示例**：

```java
Class<?> clazz = Integer.class;
Class<?> superClass = clazz.getSuperclass();
System.out.println(superClass.getName());  // java.lang.Number
```

#### 3.2.5 getInterfaces() - 获取实现的接口

```java
public native Class<?>[] getInterfaces();
```

**使用示例**：

```java
Class<?> clazz = ArrayList.class;
Class<?>[] interfaces = clazz.getInterfaces();
for (Class<?> iface : interfaces) {
    System.out.println(iface.getName());
}
```

#### 3.2.6 isInterface() - 是否为接口

```java
public native boolean isInterface();
```

#### 3.2.7 isArray() - 是否为数组

```java
public native boolean isArray();
```

#### 3.2.8 isPrimitive() - 是否为基本类型

```java
public native boolean isPrimitive();
```

**使用示例**：

```java
System.out.println(int.class.isPrimitive());  // true
System.out.println(Integer.class.isPrimitive());  // false
```

#### 3.2.9 isAssignableFrom(Class<?> cls) - 是否可从指定类赋值

```java
public native boolean isAssignableFrom(Class<?> cls);
```

**使用示例**：

```java
Class<?> numberClass = Number.class;
Class<?> integerClass = Integer.class;
System.out.println(numberClass.isAssignableFrom(integerClass));  // true
```

#### 3.2.10 newInstance() - 创建新实例

```java
public T newInstance() throws InstantiationException, IllegalAccessException {
    if (System.getSecurityManager() != null) {
        checkMemberAccess(Member.PUBLIC);
    }
    return newInstance0();
}

private native T newInstance0() throws InstantiationException, IllegalAccessException;
```

**特点**：
- 调用无参构造方法
- 已废弃，推荐使用Constructor.newInstance()

**使用示例**：

```java
Class<?> clazz = String.class;
Object obj = clazz.newInstance();  // 调用String()
```

#### 3.2.11 getConstructor(Class<?>... parameterTypes) - 获取构造方法

```java
public Constructor<T> getConstructor(Class<?>... parameterTypes)
    throws NoSuchMethodException, SecurityException {
    checkMemberAccess(Member.PUBLIC);
    return getConstructor0(parameterTypes);
}
```

**使用示例**：

```java
Class<?> clazz = String.class;
Constructor<?> constructor = clazz.getConstructor(byte[].class);
String str = (String) constructor.newInstance("Hello".getBytes());
```

#### 3.2.12 getMethod(String name, Class<?>... parameterTypes) - 获取公共方法

```java
public Method getMethod(String name, Class<?>... parameterTypes)
    throws NoSuchMethodException, SecurityException {
    checkMemberAccess(Member.PUBLIC);
    Method method = getMethod0(name, parameterTypes);
    if (method == null) {
        throw new NoSuchMethodException(getName() + "." + name + argumentTypesToString(parameterTypes));
    }
    return method;
}
```

**使用示例**：

```java
Class<?> clazz = String.class;
Method method = clazz.getMethod("length");
int length = (int) method.invoke("Hello");
```

#### 3.2.13 getField(String name) - 获取公共字段

```java
public Field getField(String name) throws NoSuchFieldException, SecurityException {
    checkMemberAccess(Member.PUBLIC);
    Field field = getField0(name);
    if (field == null) {
        throw new NoSuchFieldException(getName() + "." + name);
    }
    return field;
}
```

**使用示例**：

```java
Class<?> clazz = Integer.class;
Field field = clazz.getField("MAX_VALUE");
int maxValue = (int) field.get(null);
```

### 3.3 使用示例

#### 3.3.1 获取类信息

```java
Class<?> clazz = String.class;

// 获取类名
System.out.println("Name: " + clazz.getName());
System.out.println("Simple Name: " + clazz.getSimpleName());

// 获取包
Package pkg = clazz.getPackage();
System.out.println("Package: " + pkg.getName());

// 获取父类
Class<?> superClass = clazz.getSuperclass();
System.out.println("Super Class: " + superClass.getName());

// 获取接口
Class<?>[] interfaces = clazz.getInterfaces();
for (Class<?> iface : interfaces) {
    System.out.println("Interface: " + iface.getName());
}
```

#### 3.3.2 反射调用方法

```java
Class<?> clazz = String.class;

// 获取方法
Method method = clazz.getMethod("substring", int.class, int.class);

// 调用方法
String str = "Hello World";
String result = (String) method.invoke(str, 0, 5);
System.out.println(result);  // Hello
```

#### 3.3.3 反射访问字段

```java
Class<?> clazz = Integer.class;

// 获取字段
Field field = clazz.getField("MAX_VALUE");

// 访问字段
int maxValue = (int) field.get(null);
System.out.println(maxValue);  // 2147483647
```

#### 3.3.4 动态创建对象

```java
// 获取类
Class<?> clazz = String.class;

// 获取构造方法
Constructor<?> constructor = clazz.getConstructor(byte[].class);

// 创建对象
String str = (String) constructor.newInstance("Hello".getBytes());
System.out.println(str);  // Hello
```

## 四、String类详解

### 4.1 String类概述

**String特点**：
- 不可变（Immutable）
- 线程安全
- 使用常量池
- 实现了CharSequence接口
- 支持序列化

### 4.2 核心字段

```java
public final class String implements java.io.Serializable, Comparable<String>, CharSequence {
    // 字符数组
    private final char value[];
    
    // 哈希码
    private int hash;
    
    // 序列化UID
    private static final long serialVersionUID = -6849794470754667710L;
}
```

**字段说明**：
- **value**：存储字符的数组
- **hash**：缓存的哈希码
- **serialVersionUID**：序列化版本号

### 4.3 构造方法

#### 4.3.1 无参构造

```java
public String() {
    this.value = new char[0];
}
```

#### 4.3.2 通过字符数组构造

```java
public String(char value[]) {
    this.value = Arrays.copyOf(value, value.length);
}
```

#### 4.3.3 通过字符数组构造（指定范围）

```java
public String(char value[], int offset, int count) {
    if (offset < 0) {
        throw new StringIndexOutOfBoundsException(offset);
    }
    if (count <= 0) {
        if (count < 0) {
            throw new StringIndexOutOfBoundsException(count);
        }
        if (offset <= value.length) {
            this.value = "";
            return;
        }
    }
    if (offset > value.length - count) {
        throw new StringIndexOutOfBoundsException(offset + count);
    }
    this.value = Arrays.copyOfRange(value, offset, offset + count);
}
```

#### 4.3.4 通过字节数组构造（使用平台默认编码）

```java
public String(byte bytes[]) {
    this(bytes, 0, bytes.length);
}
```

#### 4.3.5 通过字节数组构造（指定字符集）

```java
public String(byte bytes[], Charset charset) {
    this(bytes, 0, bytes.length, charset);
}
```

#### 4.3.6 通过另一个String构造

```java
public String(String original) {
    this.value = original.value;
    this.hash = original.hash;
}
```

**特点**：共享字符数组，不进行拷贝

### 4.4 核心方法

#### 4.4.1 length() - 获取字符串长度

```java
public int length() {
    return value.length;
}
```

#### 4.4.2 isEmpty() - 是否为空字符串

```java
public boolean isEmpty() {
    return value.length == 0;
}
```

#### 4.4.3 charAt(int index) - 获取指定位置的字符

```java
public char charAt(int index) {
    if ((index < 0) || (index >= value.length)) {
        throw new StringIndexOutOfBoundsException(index);
    }
    return value[index];
}
```

#### 4.4.4 getBytes() - 获取字节数组（使用平台默认编码）

```java
public byte[] getBytes() {
    return StringCoding.encode(value, 0, value.length);
}
```

#### 4.4.5 getBytes(Charset charset) - 获取字节数组（指定字符集）

```java
public byte[] getBytes(Charset charset) {
    if (charset == null) throw new NullPointerException();
    return StringCoding.encode(value, 0, value.length, charset);
}
```

#### 4.4.6 equals(Object anObject) - 判断相等

```java
public boolean equals(Object anObject) {
    if (this == anObject) {
        return true;
    }
    if (anObject instanceof String) {
        String anotherString = (String)anObject;
        if (value.length == anotherString.value.length) {
            char v1[] = value;
            char v2[] = anotherString.value;
            int i = 0;
            int n = value.length;
            while (n-- != 0) {
                if (v1[i] != v2[i])
                    return false;
                i++;
            }
            return true;
        }
    }
    return false;
}
```

**特点**：
- 先比较引用
- 再比较长度
- 最后逐个字符比较

#### 4.4.7 equalsIgnoreCase(String anotherString) - 忽略大小写判断相等

```java
public boolean equalsIgnoreCase(String anotherString) {
    return (this == anotherString) ? true :
           (anotherString != null) && (anotherString.value.length == value.length)
           && regionMatches(true, 0, anotherString, 0, value.length);
}
```

#### 4.4.8 compareTo(String anotherString) - 比较字符串

```java
public int compareTo(String anotherString) {
    int len1 = value.length;
    int len2 = anotherString.value.length;
    int lim = Math.min(len1, len2);
    char v1[] = value;
    char v2[] = anotherString.value;
    
    int k = 0;
    while (k < lim) {
        char c1 = v1[k];
        char c2 = v2[k];
        if (c1 != c2) {
            return c1 - c2;
        }
        k++;
    }
    return len1 - len2;
}
```

**特点**：
- 实现Comparable接口
- 按字典序比较
- 返回负数、0、正数

#### 4.4.9 hashCode() - 获取哈希码

```java
public int hashCode() {
    int h = hash;
    if (h == 0 && value.length > 0) {
        char val[] = value;
        for (int i = 0; i < value.length; i++) {
            h = 31 * h + val[i];
        }
        hash = h;
    }
    return h;
}
```

**特点**：
- 缓存哈希码
- 计算公式：s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]

#### 4.4.10 indexOf(int ch) - 查找字符

```java
public int indexOf(int ch) {
    return indexOf(ch, 0);
}
```

#### 4.4.11 indexOf(int ch, int fromIndex) - 从指定位置查找字符

```java
public int indexOf(int ch, int fromIndex) {
    final int max = value.length;
    if (fromIndex < 0) {
        fromIndex = 0;
    } else if (fromIndex >= max) {
        return -1;
    }
    
    if (ch < Character.MIN_SUPPLEMENTARY_CODE_POINT) {
        for (int i = fromIndex; i < max; i++) {
            if (value[i] == ch) {
                return i;
            }
        }
        return -1;
    } else {
        return indexOfSupplementary(ch, fromIndex);
    }
}
```

#### 4.4.12 substring(int beginIndex) - 获取子字符串

```java
public String substring(int beginIndex) {
    if (beginIndex < 0) {
        throw new StringIndexOutOfBoundsException(beginIndex);
    }
    int subLen = value.length - beginIndex;
    if (subLen < 0) {
        throw new StringIndexOutOfBoundsException(subLen);
    }
    return (beginIndex == 0) ? this : new String(value, beginIndex, subLen);
}
```

#### 4.4.13 substring(int beginIndex, int endIndex) - 获取子字符串

```java
public String substring(int beginIndex, int endIndex) {
    if (beginIndex < 0) {
        throw new StringIndexOutOfBoundsException(beginIndex);
    }
    if (endIndex > value.length) {
        throw new StringIndexOutOfBoundsException(endIndex);
    }
    int subLen = endIndex - beginIndex;
    if (subLen < 0) {
        throw new StringIndexOutOfBoundsException(subLen);
    }
    return ((beginIndex == 0) && (endIndex == value.length)) ? this
           : new String(value, beginIndex, subLen);
}
```

#### 4.4.14 concat(String str) - 连接字符串

```java
public String concat(String str) {
    int otherLen = str.length();
    if (otherLen == 0) {
        return this;
    }
    int len = value.length;
    char buf[] = Arrays.copyOf(value, len + otherLen);
    str.getChars(buf, len);
    return new String(buf, true);
}
```

#### 4.4.15 replace(char oldChar, char newChar) - 替换字符

```java
public String replace(char oldChar, char newChar) {
    if (oldChar != newChar) {
        int len = value.length;
        int i = -1;
        char[] val = value;
        
        while (++i < len) {
            if (val[i] == oldChar) {
                break;
            }
        }
        if (i < len) {
            char buf[] = new char[len];
            for (int j = 0; j < i; j++) {
                buf[j] = val[j];
            }
            while (i < len) {
                char c = val[i];
                buf[i] = (c == oldChar) ? newChar : c;
                i++;
            }
            return new String(buf, true);
        }
    }
    return this;
}
```

#### 4.4.16 toLowerCase() - 转换为小写

```java
public String toLowerCase() {
    return toLowerCase(Locale.getDefault());
}
```

#### 4.4.17 toUpperCase() - 转换为大写

```java
public String toUpperCase() {
    return toUpperCase(Locale.getDefault());
}
```

#### 4.4.18 trim() - 去除首尾空白

```java
public String trim() {
    int len = value.length;
    int st = 0;
    char[] val = value;
    
    while ((st < len) && (val[st] <= ' ')) {
        st++;
    }
    while ((st < len) && (val[len - 1] <= ' ')) {
        len--;
    }
    return ((st > 0) || (len < value.length)) ? substring(st, len) : this;
}
```

#### 4.4.19 split(String regex) - 分割字符串

```java
public String[] split(String regex) {
    return split(regex, 0);
}
```

#### 4.4.20 split(String regex, int limit) - 分割字符串（限制数量）

```java
public String[] split(String regex, int limit) {
    char ch = 0;
    if (((regex.value.length == 1 &&
         ".$|()[{^?*+\\".indexOf(ch = regex.charAt(0)) == -1) ||
        (regex.length() == 2 &&
         regex.charAt(0) == '\\' &&
         (((ch = regex.charAt(1))-'')|(''-'ch)) < ('\\'-'\''))) {
        int off = 0;
        int next = 0;
        boolean limited = limit > 0;
        ArrayList<String> list = new ArrayList<>();
        while ((next = indexOf(ch, off)) != -1) {
            if (!limited || list.size() < limit - 1) {
                list.add(substring(off, next));
                off = next + 1;
            } else {
                list.add(substring(off, value.length));
                off = value.length;
                break;
            }
        }
        if (off == 0) {
            return new String[]{this};
        }
        list.add(substring(off, value.length));
        int resultSize = list.size();
        if (limit == 0) {
            while (resultSize > 0 && list.get(resultSize - 1).isEmpty()) {
                resultSize--;
            }
        }
        return list.subList(0, resultSize).toArray(new String[resultSize]);
    }
    return Pattern.compile(regex).split(this, limit);
}
```

### 4.5 使用示例

#### 4.5.1 基本操作

```java
String str = "Hello World";

// 获取长度
int length = str.length();

// 获取字符
char ch = str.charAt(0);

// 获取字节数组
byte[] bytes = str.getBytes();

// 判断相等
boolean equals = str.equals("Hello World");

// 比较字符串
int cmp = str.compareTo("Hello World");
```

#### 4.5.2 查找和替换

```java
String str = "Hello World";

// 查找字符
int index = str.indexOf('o');

// 查找字符串
int index2 = str.indexOf("World");

// 替换字符
String replaced = str.replace('o', 'a');

// 替换字符串
String replaced2 = str.replace("World", "Java");
```

#### 4.5.3 子字符串和分割

```java
String str = "Hello World";

// 获取子字符串
String sub = str.substring(0, 5);

// 分割字符串
String[] parts = str.split(" ");
```

#### 4.5.4 大小写转换

```java
String str = "Hello World";

// 转换为小写
String lower = str.toLowerCase();

// 转换为大写
String upper = str.toUpperCase();
```

## 五、StringBuilder与StringBuffer详解

### 5.1 StringBuilder概述

**StringBuilder特点**：
- 可变字符串
- 非线程安全
- 性能高
- 适用于单线程环境

### 5.2 StringBuffer概述

**StringBuffer特点**：
- 可变字符串
- 线程安全
- 性能稍低
- 适用于多线程环境

### 5.3 核心方法

#### 5.3.1 append(String str) - 追加字符串

```java
public StringBuilder append(String str) {
    super.append(str);
    return this;
}
```

#### 5.3.2 insert(int offset, String str) - 插入字符串

```java
public StringBuilder insert(int offset, String str) {
    super.insert(offset, str);
    return this;
}
```

#### 5.3.3 delete(int start, int end) - 删除字符

```java
public StringBuilder delete(int start, int end) {
    super.delete(start, end);
    return this;
}
```

#### 5.3.4 replace(int start, int end, String str) - 替换字符

```java
public StringBuilder replace(int start, int end, String str) {
    super.replace(start, end, str);
    return this;
}
```

#### 5.3.5 reverse() - 反转字符串

```java
public StringBuilder reverse() {
    super.reverse();
    return this;
}
```

#### 5.3.6 toString() - 转换为String

```java
public String toString() {
    return new String(value, 0, count);
}
```

### 5.4 使用示例

#### 5.4.1 StringBuilder使用

```java
StringBuilder sb = new StringBuilder();
sb.append("Hello");
sb.append(" ");
sb.append("World");
String str = sb.toString();
System.out.println(str);  // Hello World
```

#### 5.4.2 StringBuffer使用

```java
StringBuffer sb = new StringBuffer();
sb.append("Hello");
sb.append(" ");
sb.append("World");
String str = sb.toString();
System.out.println(str);  // Hello World
```

## 六、包装类详解

### 6.1 包装类概述

**包装类特点**：
- 基本类型的对象表示
- 支持自动装箱/拆箱
- 提供常量和方法
- 不可变

### 6.2 自动装箱与拆箱

**装箱（Boxing）**：基本类型 → 包装类

```java
Integer i = Integer.valueOf(10);
// 自动装箱
Integer i2 = 10;
```

**拆箱（Unboxing）**：包装类 → 基本类型

```java
int value = i.intValue();
// 自动拆箱
int value2 = i;
```

### 6.3 核心方法

#### 6.3.1 valueOf() - 获取包装类实例

```java
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high) {
        return IntegerCache.cache[i + (-IntegerCache.low)];
    }
    return new Integer(i);
}
```

**特点**：
- 使用缓存（-128到127）
- 减少对象创建

#### 6.3.2 xxxValue() - 获取基本类型值

```java
public int intValue() {
    return value;
}

public long longValue() {
    return (long)value;
}

public float floatValue() {
    return (float)value;
}

public double doubleValue() {
    return (double)value;
}
```

#### 6.3.3 toString() - 转换为字符串

```java
public static String toString(int i) {
    if (i == Integer.MIN_VALUE) {
        return "-2147483648";
    }
    int size = (i < 0) ? stringSize(-i) + 1 : stringSize(i);
    char[] buf = new char[size];
    getChars(i, size, buf);
    return new String(buf, true);
}
```

#### 6.3.4 parseInt(String s) - 字符串转换为int

```java
public static int parseInt(String s) throws NumberFormatException {
    return parseInt(s, 10);
}

public static int parseInt(String s, int radix) throws NumberFormatException {
    if (s == null) {
        throw new NumberFormatException("null");
    }
    
    if (radix < Character.MIN_RADIX) {
        throw new NumberFormatException("radix " + radix +
                                    " less than Character.MIN_RADIX");
    }
    
    if (radix > Character.MAX_RADIX) {
        throw new NumberFormatException("radix " + radix +
                                    " greater than Character.MAX_RADIX");
    }
    
    int result = 0;
    boolean negative = false;
    int i = 0, len = s.length();
    int limit = -Integer.MAX_VALUE;
    int multmin;
    int digit;
    
    if (len > 0) {
        char firstChar = s.charAt(0);
        if (firstChar < '0') {
            if (firstChar == '-') {
                negative = true;
                limit = Integer.MIN_VALUE;
            } else if (firstChar != '+') {
                throw NumberFormatException.forInputString(s);
            }
            if (len == 1) {
                throw NumberFormatException.forInputString(s);
            }
            i++;
        }
        multmin = limit / radix;
        while (i < len) {
            digit = Character.digit(s.charAt(i++), radix);
            if (digit < 0) {
                throw NumberFormatException.forInputString(s);
            }
            if (result < multmin) {
                throw NumberFormatException.forInputString(s);
            }
            result *= radix;
            if (result < limit + digit) {
                throw NumberFormatException.forInputString(s);
            }
            result -= digit;
        }
    } else {
        throw NumberFormatException.forInputString(s);
    }
    return negative ? result : -result;
}
```

### 6.4 使用示例

#### 6.4.1 自动装箱与拆箱

```java
// 自动装箱
Integer i = 10;

// 自动拆箱
int value = i;

// 比较
Integer a = 100;
Integer b = 100;
System.out.println(a == b);  // true（缓存）
System.out.println(a.equals(b));  // true
```

#### 6.4.2 类型转换

```java
// 字符串转int
int value = Integer.parseInt("123");

// int转字符串
String str = Integer.toString(123);

// 其他类型转换
double d = 123.45;
int i = (int) d;
```

## 七、Math类详解

### 7.1 Math类概述

**Math特点**：
- 静态方法
- 不可实例化
- 提供数学运算
- 精确计算

### 7.2 核心方法

#### 7.2.1 abs() - 绝对值

```java
public static int abs(int a) {
    return (a < 0) ? -a : a;
}

public static long abs(long a) {
    return (a < 0) ? -a : a;
}

public static float abs(float a) {
    return (a <= 0.0F) ? 0.0F - a : a;
}

public static double abs(double a) {
    return (a <= 0.0D) ? 0.0D - a : a;
}
```

#### 7.2.2 max() - 最大值

```java
public static int max(int a, int b) {
    return (a >= b) ? a : b;
}
```

#### 7.2.3 min() - 最小值

```java
public static int min(int a, int b) {
    return (a <= b) ? a : b;
}
```

#### 7.2.4 round() - 四舍五入

```java
public static int round(float a) {
    int intBits = Float.floatToIntBits(a);
    int bias = intBits >> 31;
    return (int)(((intBits & ~0x80000000) + bias) >> 23);
}

public static long round(double a) {
    long longBits = Double.doubleToLongBits(a);
    long bias = longBits >> 63;
    return (long)(((longBits & ~0x8000000000000000L) + bias) >> 52);
}
```

#### 7.2.5 ceil() - 向上取整

```java
public static double ceil(double a) {
    return StrictMath.ceil(a);
}
```

#### 7.2.6 floor() - 向下取整

```java
public static double floor(double a) {
    return StrictMath.floor(a);
}
```

#### 7.2.7 pow() - 幂运算

```java
public static double pow(double a, double b) {
    return StrictMath.pow(a, b);
}
```

#### 7.2.8 sqrt() - 平方根

```java
public static double sqrt(double a) {
    return StrictMath.sqrt(a);
}
```

#### 7.2.9 random() - 随机数

```java
public static double random() {
    return RandomNumberGeneratorHolder.randomNumberGenerator.nextDouble();
}
```

### 7.3 使用示例

```java
// 绝对值
int abs = Math.abs(-10);

// 最大值
int max = Math.max(10, 20);

// 最小值
int min = Math.min(10, 20);

// 四舍五入
long rounded = Math.round(3.5);

// 向上取整
double ceil = Math.ceil(3.1);

// 向下取整
double floor = Math.floor(3.9);

// 幂运算
double pow = Math.pow(2, 3);

// 平方根
double sqrt = Math.sqrt(16);

// 随机数
double random = Math.random();
```

## 八、System类详解

### 8.1 System类概述

**System特点**：
- 静态方法
- 不可实例化
- 访问系统资源
- 标准输入输出

### 8.2 核心字段

#### 8.2.1 in - 标准输入流

```java
public static final InputStream in = null;
```

#### 8.2.2 out - 标准输出流

```java
public static final PrintStream out = null;
```

#### 8.2.3 err - 标准错误流

```java
public static final PrintStream err = null;
```

### 8.3 核心方法

#### 8.3.1 currentTimeMillis() - 当前时间（毫秒）

```java
public static native long currentTimeMillis();
```

#### 8.3.2 nanoTime() - 当前时间（纳秒）

```java
public static native long nanoTime();
```

#### 8.3.3 arraycopy() - 数组拷贝

```java
public static native void arraycopy(Object src,  int  srcPos,
                                Object dest, int destPos,
                                int length);
```

#### 8.3.4 gc() - 建议垃圾回收

```java
public static void gc() {
    Runtime.getRuntime().gc();
}
```

#### 8.3.5 exit(int status) - 退出JVM

```java
public static void exit(int status) {
    Runtime.getRuntime().exit(status);
}
```

#### 8.3.6 getProperty(String key) - 获取系统属性

```java
public static String getProperty(String key) {
    checkKey(key);
    return props.getProperty(key);
}
```

### 8.4 使用示例

```java
// 获取当前时间
long time = System.currentTimeMillis();

// 数组拷贝
int[] src = {1, 2, 3};
int[] dest = new int[3];
System.arraycopy(src, 0, dest, 0, 3);

// 建议垃圾回收
System.gc();

// 获取系统属性
String javaHome = System.getProperty("java.home");

// 标准输出
System.out.println("Hello World");

// 标准错误
System.err.println("Error");
```

## 九、最佳实践

### 9.1 重写equals()和hashCode()

```java
@Override
public boolean equals(Object obj) {
    if (this == obj) {
        return true;
    }
    if (obj == null || getClass() != obj.getClass()) {
        return false;
    }
    Person person = (Person) obj;
    return age == person.age && Objects.equals(name, person.name);
}

@Override
public int hashCode() {
    return Objects.hash(name, age);
}
```

### 9.2 使用StringBuilder代替字符串连接

```java
// 不推荐
String str = "";
for (int i = 0; i < 1000; i++) {
    str += i;
}

// 推荐
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 1000; i++) {
    sb.append(i);
}
String str = sb.toString();
```

### 9.3 使用try-with-resources

```java
// 推荐
try (InputStream is = new FileInputStream("test.txt")) {
    // 使用流
}
```

### 9.4 使用Objects工具类

```java
// 判断相等
boolean equals = Objects.equals(obj1, obj2);

// 判断为null
boolean isNull = Objects.isNull(obj);

// 获取哈希码
int hashCode = Objects.hashCode(obj);

// 非空检查
Objects.requireNonNull(obj);
```

## 十、相关源码位置

| 类名 | 源码路径 |
|------|----------|
| Object | src/main/jdk8/java/lang/Object.java |
| Class | src/main/jdk8/java/lang/Class.java |
| String | src/main/jdk8/java/lang/String.java |
| StringBuilder | src/main/jdk8/java/lang/StringBuilder.java |
| StringBuffer | src/main/jdk8/java/lang/StringBuffer.java |
| Integer | src/main/jdk8/java/lang/Integer.java |
| Long | src/main/jdk8/java/lang/Long.java |
| Double | src/main/jdk8/java/lang/Double.java |
| Float | src/main/jdk8/java/lang/Float.java |
| Short | src/main/jdk8/java/lang/Short.java |
| Byte | src/main/jdk8/java/lang/Byte.java |
| Character | src/main/jdk8/java/lang/Character.java |
| Boolean | src/main/jdk8/java/lang/Boolean.java |
| Math | src/main/jdk8/java/lang/Math.java |
| System | src/main/jdk8/java/lang/System.java |
| Thread | src/main/jdk8/java/lang/Thread.java |
| Objects | src/main/jdk8/java/util/Objects.java |
